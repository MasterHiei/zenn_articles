---
title: "go_routerã§è‡ªä½œClassã‚’æ¸¡ã™æ–¹æ³•"
emoji: "ğŸ‘‹"
type: "tech"
topics: ["Flutter", "go_router", "go_router_builder"]
publication_name: "minma"
published: true
---
# ã¯ã˜ã‚ã«

[go_router](https://pub.dev/packages/go_router) v12.1.0ã‚ˆã‚Šã€`codec`ã‚’ä½¿ã£ã¦`$extra`ã‚’ã‚·ãƒªã‚¢ãƒ«åŒ–ãƒ»é€†ã‚·ãƒªã‚¢ãƒ«åŒ–ã™ã‚‹æ–¹æ³•ãŒæä¾›ã•ã‚Œã¾ã—ãŸã€‚

ã“ã®æ–¹æ³•ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã«ã‚ˆã£ã¦ã€ä»Šã¾ã§ã§ããªã‹ã£ãŸç”»é¢é·ç§»æ™‚ã«è‡ªä½œClassã‚’æ¸¡ã™å‡¦ç†ã‚’å®Ÿè£…ã§ãã¾ã™ã€‚

# å¾“æ¥ã®ç”»é¢é–“æƒ…å ±å…±æœ‰

```dart
@TypedGoRoute<FirstRoute>(path: '/')
@immutable
class FirstRoute extends GoRouteData {
  const FirstRoute();

  @override
  Widget build(BuildContext context, GoRouterState state) {
    return FirstPage();
  }
}

@TypedGoRoute<SecondRoute>(path: '/second')
@immutable
class SecondRoute extends GoRouteData {
  const SecondRoute({
    required this.id,
    required this.name,
  });

  final String id;
  final String name;

  @override
  Widget build(BuildContext context, GoRouterState state) {
    return SecondPage(id: id, name: name);
  }
}

// ç”»é¢é·ç§»
SecondRoute(id: id, name: name).push<void>(context);
```

ä¸Šè¨˜ã®ã‚ˆã†ã«ã€æ¬¡ã®ç”»é¢ã¸é€ã‚ŠãŸã„ãƒ‡ãƒ¼ã‚¿ã¯åˆ¥ã€…ã§ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã¨ã—ã¦å®šç¾©ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

ã“ã®ã‚ˆã†ã«å®Ÿè£…ã™ã‚‹ã¨ã€ãƒ‡ãƒ¼ã‚¿æ§‹é€ ãŒè¤‡é›‘ã«ãªã‚Œã°ãªã‚‹ã»ã©ã€ã‚³ãƒ¼ãƒ‰ãŒèª­ã¿ã¥ã‚‰ããªã‚Šãƒã‚°ã‚‚ç™ºç”Ÿã—ã‚„ã™ããªã‚Šã¾ã™ã€‚

ã¡ã‚‡ã£ã¨æ°—æŒã¡æ‚ªã„ã§ã™ã­â€¦ã§ã¯`$extra`ã‚’ä½¿ã£ãŸã‚‰ã©ã†ãªã‚‹ï¼Ÿ

# `$extra`ã‚’ä½¿ã£ãŸã‚‰è¡Œã‘ã‚‹ã®ã§ã¯ï¼Ÿ

```dart
@TypedGoRoute<FirstRoute>(path: '/')
@immutable
class FirstRoute extends GoRouteData {
  const FirstRoute();

  @override
  Widget build(BuildContext context, GoRouterState state) {
    return FirstPage();
  }
}

@TypedGoRoute<SecondRoute>(path: '/second')
@immutable
class SecondRoute extends GoRouteData {
  const SecondRoute(this.$extra);

  final Person $extra;

  @override
  Widget build(BuildContext context, GoRouterState state) {
    return SecondPage($extra);
  }
}

// ç”»é¢é·ç§»
final person = Person(id: id, name: name);
SecondRoute(person).push<void>(context);
```

ã‚‚ã†è§£æ±ºã§ããŸã‚“ã˜ã‚ƒãªã„ã§ã™ã‹ï¼ï¼Ÿ

ã¯ã„ã€è§£æ±ºã§ãã¾ã—ãŸã€‚

ãŒã€ã¾ãŸåˆ¥ã®å•é¡ŒãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚

Flutterå…¬å¼ã®Issueã«ã‚ˆã‚‹ã¨ã€Widgetã®çŠ¶æ…‹ãŒå¤‰åŒ–ã—ãŸã‚‰`$extra`ã®å€¤ãŒnullã«ãªã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚

https://github.com/flutter/flutter/issues/99099

https://github.com/flutter/flutter/issues/137248

ãã®ãŸã‚ã€`$extra`ã®æŒ™å‹•ãŒä¸å®‰å®šã¨ã„ã†èª²é¡ŒãŒã¾ã æ®‹ã£ã¦ã¾ã™ã€‚

ãã—ã¦ã“ã®èª²é¡Œã‚’è§£æ±ºã—ãŸã®ã¯ã€ä»Šå›ç™»å ´ã•ã‚ŒãŸ`codec`ã§ã™ã€‚

# `codec`+`$extra`ã‚’ä½¿ã£ãŸç”»é¢é–“æƒ…å ±å…±æœ‰

```dart
// Codec
class ExtraCodec extends Codec<Object?, Object?> {
  const ExtraCodec();

  @override
  Converter<Object?, Object?> get decoder => const _Decoder();

  @override
  Converter<Object?, Object?> get encoder => const _Encoder();
}

class _Decoder extends Converter<Object?, Object?> {
  const _Decoder();
  @override
  Object? convert(Object? input) {
    if (input == null) {
      return null;
    }
    final List<Object?> objects = input as List<Object?>;
    // å„ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã®è¨­å®š
    // ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ãŒå¢—ãˆã‚‹ãŸã³ã«switch-caseã‚’è¿½åŠ 
    switch (objects[0]) {
      case 'Person':
        return Person(
          id: objects[1]! as String,
          name: objects[2]! as String,
        );
    }
    throw FormatException('Unable to parse input: $input.');
  }
}

class _Encoder extends Converter<Object?, Object?> {
  const _Encoder();
  @override
  Object? convert(Object? input) {
    if (input == null) {
      return null;
    }
    // å„ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã®è¨­å®š
    // ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ãŒå¢—ãˆã‚‹ãŸã³ã«switch-caseã‚’è¿½åŠ 
    switch (input) {
      case Person _:
        return [
          'Person', // å„ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã®ä¸€æ„è­˜åˆ¥å­
          input.id,
          input.name,
        ];
      default:
        throw FormatException('Cannot encode type ${input.runtimeType}.');
    }
  }
}

// codecè¨­å®š
final router = GoRouter(
  extraCodec: const RouteExtraCodec(),
  // ...
);

class MyApp extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    return MaterialApp.router(
      routerConfig: router,
      // ...
    );
  }
}

// ç”»é¢é·ç§»
final person = Person(id: id, name: name);
SecondRoute(person).push<void>(context);
```

å®Ÿè£…ãŒè‹¥å¹²ã‚„ã‚„ã“ã—ããªã‚Šã¾ã—ãŸãŒã€

Codecã®è¨­å®šã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã§`$extra`ã®ã‚·ãƒªã‚¢ãƒ«åŒ–ãƒ»é€†ã‚·ãƒªã‚¢ãƒ«åŒ–ãŒå¯èƒ½ã«ãªã‚Šã€

ä¸Šè¨˜ã®ä¸å…·åˆã‚’è§£æ¶ˆã§ãã¾ã—ãŸã€‚

# ã•ã„ã”ã«

ä»Šå›ã¯`codec`ã¨`$extra`ã‚’åˆ©ç”¨ã—ã¦ç”»é¢é·ç§»æ™‚ã«è‡ªä½œClassã‚’æ¸¡ã™æ–¹æ³•ã‚’ç´¹ä»‹ã—ã¾ã—ãŸã€‚

ã—ã‹ã—ã€ã“ã®æ–¹æ³•ã¯ã‚ãã¾ã§ã‚‚ä¸€æ™‚çš„ãªæ‰‹æ®µã¨è€ƒãˆã¦ã„ã‚‹ãŸã‚ã€ã¾ãŸæ–°ã—ã„æŠ€ãŒç”Ÿã¾ã‚Œã‚‹å¯èƒ½æ€§ãŒé«˜ã„ã¨æ€ã„ã¾ã™ã€‚

ä»Šå¾Œã‚‚å¼•ãç¶šãæ³¨æ„ã—ã¾ã™ã€‚
