---
title: "ãã‚“ãªã‚³ãƒ¼ãƒ‰ã§å¤§ä¸ˆå¤«ã‹ï¼Ÿ"
emoji: "ğŸ“š"
type: "tech"
topics: ["Flutter", "Dart", "ãƒã‚¦ãƒã‚¦"]
publication_name: "minma"
published: true
---
# `StatefulWidget`

## `initState()`ãŒå®Œäº†ã—ã¦ã‹ã‚‰`context`ã‚’èª­ã¿å–ã‚‹

- âŒBad
```dart
class _MyWidgetState extends State<MyWidget> {
  int _counter = 0;

  @override
  void initState() {
    super.initState();
    final width = MediaQuery.of(context).size.width;
    print(width); // ğŸ’¥dependOnInheritedWidgetOfExactType<MediaQuery>() or dependOnInheritedElement() was called before _MyWidgetState.initState() completed
  }

  @override
  Widget build(BuildContext context) {
    return Center(child: Text('$_counter'));
  }
}
```

- âœ…Good
```dart
class _MyWidgetState extends State<MyWidget> {
  int _counter = 0;

  @override
  void initState() {
    super.initState();
    WidgetsBinding.instance.addPostFrameCallback(
      (_) {
        final width = MediaQuery.of(context).size.width;
        print(width);
      },
    );
  }

  @override
  Widget build(BuildContext context) {
    return Center(child: Text('$_counter'));
  }
}
```

## `setState`ã‚’å®Ÿè¡Œã™ã‚‹å‰ã«Widgetã®æœ‰ç„¡ã‚’ç¢ºèªã™ã‚‹

- âŒBad
```dart
class _MyWidgetState extends State<MyWidget> {
  int _counter = 0;

  @override
  Widget build(BuildContext context) {
    return Center(
      child: ElevatedButton(
        onPressed: () {
          Future.delayed(
            const Duration(seconds: 1),
            () => setState(() => _counter++), // ğŸ’¥setState() called after dispose()
          );
          Navigator.pop(context);
        },
        child: Text('$_counter'),
      ),
    );
  }
}
```

- âœ…Good
```dart
class _MyWidgetState extends State<MyWidget> {
  int _counter = 0;

  @override
  Widget build(BuildContext context) {
    return Center(
      child: ElevatedButton(
        onPressed: () {
          Future.delayed(
            const Duration(seconds: 1),
            () {
              if (context.mounted) {
                setState(() => _counter++);
              }
            },
          );
          Navigator.pop(context);
        },
        child: Text('$_counter'),
      ),
    );
  }
}
```

# `List`

## é©åˆ‡ãªAPIã‚’ä½¿ã†

- âŒBad
```dart
void main() {
  print([].first); // ğŸ’¥Bad state: No element
  print([].last); // ğŸ’¥Bad state: No element
}
```

- âœ…Good
```dart
void main() {
  print([].firstOrNull); // null
  print([].lastOrNull); // null
}
```

## Indexã‚’å®‰å…¨ã«æ¸¡ã™

- âŒBad
```dart
void main() {
  print([1, 2][3]); // ğŸ’¥Index out of range
}
```

- âœ…Goodâ‘ 
```dart
extension type SafeList<E>(List<E> _) {
  E? operator [](int index) => index < length ? this[index] : null;
}

void main() {
  print(SafeList([1, 2])[3]); // null
}
```

- âœ…Goodâ‘¡
```dart
extension SafeListExt on List {
  E? tryGet<E>(int index) => index < length ? this[index] : null;
}

void main() {
  print([1, 2].tryGet(3)); // null
}
```

# å‹å¤‰æ›

## æš—é»™çš„ãªã‚­ãƒ£ã‚¹ãƒˆã‚’æ´»ç”¨ã™ã‚‹

- âŒBad
```dart
void main() {
  dynamic a = 1;
  print(a as String); // ğŸ’¥TypeError: type 'int' is not a subtype of type 'String'
}
```

- âœ…Good
```dart
void main() {
  dynamic a = 1;
  if (a is String) {
    print(a);
  } else {
    print(a.runtimeType); // int
  }
}
```

# URL

## æœ€åˆã‹ã‚‰Uriå½¢å¼ã«ã—ã¦åˆ©ç”¨ã™ã‚‹


- âŒBadâ‘ 
```dart
void main() {
  // æ¼¢å­—ã‚„ã‚¹ãƒšãƒ¼ã‚¹ã‚’æ­£ã—ãè§£æã•ã‚Œãªã‹ã£ãŸã‚Šã€XSSãªã©ã®ã‚µã‚¤ãƒãƒ¼æ”»æ’ƒã‚’å—ã‘ãŸã‚Šã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹
  final param = 'æ—¥æœ¬èª 1';
  print('https://www.example.com/page1?param=$param');
}
```

- âŒBadâ‘¡
```dart
void main() {
  // ä¸Šè¨˜ãƒªã‚¹ã‚¯ã‚’å›é¿ã§ããŸãŒã€ã‚³ãƒ¼ãƒ‰ãŒé•·ãã¦èª­ã¿ã«ãã„
  final param1 = 'æ—¥æœ¬èª 1';
  final param2 = 'æ—¥æœ¬èª 2';
  print('https://www.example.com/page1?param1=${Uri.encodeFull(param1)}&param2=${Uri.encodeFull(param2)}');
}
```

- âœ…Good
```dart
void main() {
  final uri = Uri(
    scheme: 'https',
    host: 'www.example.com',
    path: 'page1',
    queryParameters: {
      'param1': 'æ—¥æœ¬èª 1',
      'param2': 'æ—¥æœ¬èª 2',
    },
  );
  print(uri);
}
```

# çµèª

å¤§ä¸ˆå¤«ã ã€å•é¡Œãªã„ã€‚
