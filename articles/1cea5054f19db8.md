---
title: "Flutter Windowsã§WebViewã‚’ä½¿ã†æ–¹æ³•â‘ "
emoji: "ğŸ¦”"
type: "tech"
topics: ["Flutter", "Windows", "webview"]
published: true
---
# ã¯ã˜ã‚ã«

å€‹äººé–‹ç™ºã§[webview_windows](https://pub.dev/packages/webview_windows)ã‚’ä½¿ã£ã¦Flutter Windowsã‚¢ãƒ—ãƒªã§Webã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’è¡¨ç¤ºã—ã¦ã„ã‚‹ãŸã‚ã€ãƒã‚¦ãƒã‚¦ã‚’å…±æœ‰ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚

ä¸€ã¤ã®è¨˜äº‹ã«ã¾ã¨ã‚ã‚‹ã¨å°‘ã—é•·ããªã‚Šãã†ãªã®ã§ã€ãƒ‘ãƒ¼ãƒˆã«åˆ†ã‘ã¦æ›¸ãã¾ã™ã€‚

ä»Šå›ã®å†…å®¹ã¯ã€ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®å°å…¥ã‹ã‚‰Webãƒšãƒ¼ã‚¸ã®è¡¨ç¤ºã¾ã§ã®ä¸€é€£ã®ä½œæ¥­ã«ãªã‚Šã¾ã™ã€‚

# ã‚·ã‚¹ãƒ†ãƒ è¦ä»¶

é–‹ç™ºã™ã‚‹å‰ã«ã€ä¸‹è¨˜ã®ã‚·ã‚¹ãƒ†ãƒ è¦ä»¶ã‚’ã™ã¹ã¦æº€ãŸã—ã¦ã„ã‚‹ã‹ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚

- Windows 10 1809ä»¥ä¸Š

- WebView2 Runtime

  [ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰](https://developer.microsoft.com/en-us/microsoft-edge/webview2/#download-section)

- Visual Studio 2019ä»¥ä¸Š

  [ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ‰‹é †](https://learn.microsoft.com/ja-jp/visualstudio/install/install-visual-studio?view=vs-2022)

  - Windows 11 SDK (10.0.22000.194ä»¥ä¸Š)

     `Visual Studio Installer`ã®`Individual components`ã‚¿ãƒ–ã‹ã‚‰`Windows 11 SDK`ã‚’è¿½åŠ ã—ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

# å°å…¥

`webview_windows`ã‚’`pubspec.yaml`ã«è¿½åŠ ã—ã¾ã™ã€‚

```yaml
# pubspec.yaml
dependencies:
  webview_windows: ^0.3.0
```

# å®Ÿè£…

## URLã§Webãƒšãƒ¼ã‚¸ã‚’è¡¨ç¤ºã™ã‚‹

ã¾ãšã¯å¿…è¦æœ€ä½é™ã®æ©Ÿèƒ½ã‚’ä½œã‚Šã¾ã—ã‚‡ã†ã€‚

```dart
class MyHomePage extends StatefulWidget {
  const MyHomePage({super.key});

  @override
  State<MyHomePage> createState() => _MyHomePageState();
}

class _MyHomePageState extends State<MyHomePage> {
  final _webviewController = WebviewController();

  @override
  void initState() {
    super.initState();
    _initWebView();
  }

  @override
  void dispose() {
    // ä¸è¦ãªãƒªã‚½ãƒ¼ã‚¹ã‚’è§£æ”¾
    _webviewController.dispose();
    super.dispose();
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      body: Webview(_webviewController),
    );
  }

  // WebviewControllerã®åˆæœŸåŒ–ã¨åˆæœŸè¨­å®šã‚’è¡Œã†
  Future<void> _initWebView() async {
    await _webviewController.initialize();

    await Future.wait([
      _webviewController.setBackgroundColor(Colors.white),
      _webviewController.setPopupWindowPolicy(WebviewPopupWindowPolicy.deny),
    ]);

    await _webviewController.loadUrl('https://zenn.dev/topics/flutter');

    // è¨­å®šã‚’åæ˜ ã™ã‚‹ãŸã‚ã€WebViewã‚’å†æç”»ã•ã›ã‚‹
    if (context.mounted) {
      setState(() {});
    }
  }
}
```

ã“ã‚Œã§ã€æŒ‡å®šã—ãŸURLã®Webãƒšãƒ¼ã‚¸ã‚’è¡¨ç¤ºã§ãã‚‹WebViewãŒã§ãã¾ã—ãŸã€‚

ã§ã‚‚ã€ã¾ã ã¾ã è¶³ã‚Šã¾ã›ã‚“ã‚ˆã­ï¼Ÿ

## ã‚¢ãƒ‰ãƒ¬ã‚¹ãƒãƒ¼ã‚’ä½œã‚‹

```dart
class _MyHomePageState extends State<MyHomePage> {
  final _webviewController = WebviewController();
  final _urlController = TextEditingController();

  // true => å‰ã®ãƒšãƒ¼ã‚¸ãŒå­˜åœ¨ã™ã‚‹ï¼ˆæˆ»ã‚Œã‚‹ï¼‰
  // false => å‰ã®ãƒšãƒ¼ã‚¸ãŒå­˜åœ¨ã—ãªã„ï¼ˆæˆ»ã‚Œãªã„ï¼‰
  var _canGoBack = false;

  @override
  void initState() {
    super.initState();
    _initWebView();
  }

  @override
  void dispose() {
    _webviewController.dispose();
    _urlController.dispose();
    super.dispose();
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      // controllerã®åˆæœŸåŒ–å‡¦ç†ãŒå®Œäº†ã™ã‚‹ã¾ã§ã€ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ã‚’è¡¨ç¤ºã™ã‚‹
      body: _webviewController.value.isInitialized
          ? Column(
              children: [
                _addressBar,
                Expanded(child: Webview(_webviewController)),
              ],
            )
          : const Center(child: CircularProgressIndicator()),
    );
  }

  // ã‚¢ãƒ‰ãƒ¬ã‚¹ãƒãƒ¼ã®å®Ÿè£…
  Widget get _addressBar => Container(
        margin: const EdgeInsets.all(4),
        decoration: BoxDecoration(
          border: Border.all(color: Colors.grey),
          borderRadius: BorderRadius.circular(8),
        ),
        child: TextField(
          // contorllerã§ç¾åœ¨è¡¨ç¤ºä¸­ã®Webãƒšãƒ¼ã‚¸ã®URLã‚’è¡¨ç¤ºã™ã‚‹
          controller: _urlController,
          decoration: InputDecoration(
            icon: Padding(
              padding: const EdgeInsets.only(left: 12),
              child: IconButton(
                // å‰ã®ãƒšãƒ¼ã‚¸ã«æˆ»ã‚Œã‚‹ãƒ»æˆ»ã‚Œãªã„ã“ã¨ã«ã‚ˆã£ã¦ã€æˆ»ã‚‹ãƒœã‚¿ãƒ³ã‚’æœ‰åŠ¹ãƒ»ç„¡åŠ¹ã«ã™ã‚‹
                onPressed: _canGoBack ? _webviewController.goBack : null,
                icon: const Icon(Icons.arrow_back),
              ),
            ),
            border: InputBorder.none,
          ),
          // Enterã‚­ãƒ¼ã‚’æŠ¼ã™ã¨ã€ä»Šå…¥åŠ›ã—ã¦ã„ã‚‹URLã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹
          onSubmitted: _webviewController.loadUrl,
        ),
      );

  Future<void> _initWebView() async {
    await _webviewController.initialize();

    await Future.wait([
      _webviewController.setBackgroundColor(Colors.white),
      _webviewController.setPopupWindowPolicy(WebviewPopupWindowPolicy.deny),
    ]);

    // URLã¨é–²è¦§å±¥æ­´ã®å¤‰æ›´ã‚’æ¤œçŸ¥ã™ã‚‹ãŸã‚ã®ãƒªã‚¹ãƒŠãƒ¼ã‚’è¿½åŠ ã™ã‚‹
    _webviewController.url.listen((url) => _urlController.text = url);
    _webviewController.historyChanged.listen(
      (event) => setState(() => _canGoBack = event.canGoBack),
    );

    await _webviewController.loadUrl('https://zenn.dev/topics/flutter');

    if (context.mounted) {
      setState(() {});
    }
  }
}
```

ã“ã‚Œã§ã€ã‚·ãƒ³ãƒ—ãƒ«ãªã‚¢ãƒ‰ãƒ¬ã‚¹ãƒãƒ¼ã‚’ä½œã‚Šã¾ã—ãŸã­ã€‚

å¥½ããªURLã‚’å…¥åŠ›ã—ã¦Webãƒšãƒ¼ã‚¸ã‚’è¡¨ç¤ºã—ãŸã‚Šå‰ã®ãƒšãƒ¼ã‚¸ã«æˆ»ã£ãŸã‚Šã™ã‚‹ã“ã¨ãŒå¯èƒ½ã«ãªã£ã¦ã¾ã™ã€‚

## æˆæœç‰©

![webview](https://storage.googleapis.com/zenn-user-upload/9d6af6b6afe4-20230915.png)

# ã¾ã¨ã‚

ä»Šå›ã¯[webview_windows](https://pub.dev/packages/webview_windows)ã‚’ä½¿ã£ã¦Webã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’è¡¨ç¤ºã™ã‚‹ã‚¢ãƒ—ãƒªã‚’ä½œæˆã—ã¾ã—ãŸã€‚

ã¾ãŸã€Streamã‚’ç›£è¦–ã—ã¦ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§URLã®è¡¨ç¤ºã‚„ã€æŒ‡å®šãƒšãƒ¼ã‚¸ã®èª­ã¿è¾¼ã¿æ©Ÿèƒ½ã‚‚å®Ÿè£…ã—ã¾ã—ãŸã€‚

WebViewã¨ã—ã¦ååˆ†ãªæ©Ÿèƒ½ã‚’å‚™ãˆã¦ã„ã‚‹ã®ã§ã¯ãªã„ã§ã—ã‚‡ã†ã‹ï¼Ÿ

ã„ã‚„ã€ã¾ã ã¾ã è¶³ã‚Šã¾ã›ã‚“ï¼

æ¬¡å›ã¯JavaScriptã‚’ä¸­å¿ƒã«æ›¸ãäºˆå®šã§ã™ã€‚ã©ã†ãæ¥½ã—ã¿ã«ãŠå¾…ã¡ãã ã•ã„ã€‚
